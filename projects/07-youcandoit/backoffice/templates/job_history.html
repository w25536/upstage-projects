<!DOCTYPE html>
<html>
<head>
    <title>{{ job.name }} - Execution History</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #333; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .nav { margin: 20px 0; }
        .nav a { margin-right: 20px; padding: 10px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; }
        .nav a:hover { background: #0056b3; }
        .job-info { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .history-table { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .empty-state { text-align: center; padding: 40px; color: #666; }
        details { margin: 0; }
        summary { cursor: pointer; color: #007bff; }
        summary:hover { text-decoration: underline; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .duration { color: #666; font-size: 12px; }
        .btn { padding: 8px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #218838; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{{ job.name }} - Execution History</h1>
            <p>Job execution logs and results</p>
        </div>
        
        <div class="nav">
            <a href="/">Dashboard</a>
            <a href="/registry">Registry</a>
            <a href="/jobs">Jobs</a>
        </div>
        
        <div class="job-info">
            <h3>Job Details</h3>
            <p><strong>Name:</strong> {{ job.name }}</p>
            <p><strong>Type:</strong> {{ job.job_type }}</p>
            {% if job.schedule %}
            <p><strong>Schedule:</strong> {{ job.schedule }}</p>
            {% else %}
            <p><strong>Schedule:</strong> Manual execution only</p>
            {% endif %}
            <p><strong>Status:</strong> {{ job.status }}</p>
            {% if job.last_run %}
            <p><strong>Last Run:</strong> {{ job.last_run }}</p>
            {% endif %}
            <a href="/jobs" class="btn">← Back to Jobs</a>
        </div>
        
        <div class="history-table">
            <h3>Execution History</h3>
            {% if executions %}
            <table>
                <thead>
                    <tr>
                        <th>Started At</th>
                        <th>Duration</th>
                        <th>Status</th>
                        <th>Result/Error</th>
                    </tr>
                </thead>
                <tbody>
                    {% for execution in executions %}
                    <tr>
                        <td>{{ execution.started_at }}</td>
                        <td class="duration">
                            {% if execution.duration_seconds %}
                                {{ execution.duration_seconds }}s
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if execution.status == 'success' %}
                                <span class="badge badge-success">✅ Success</span>
                            {% elif execution.status == 'failed' %}
                                <span class="badge badge-danger">❌ Failed</span>
                            {% elif execution.status == 'running' %}
                                <span class="badge badge-warning">⏳ Running</span>
                            {% else %}
                                <span class="badge">{{ execution.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if execution.error_message %}
                                <details>
                                    <summary style="color: #dc3545;">Error Details</summary>
                                    <pre>{{ execution.error_message }}</pre>
                                </details>
                            {% elif execution.result %}
                                <details>
                                    <summary>View Result</summary>
                                    <pre>{{ execution.result | tojson(indent=2) }}</pre>
                                </details>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <p>No execution history yet. Run this job to see execution logs.</p>
            </div>
            {% endif %}
        </div>
    </div>
</body>
</html>